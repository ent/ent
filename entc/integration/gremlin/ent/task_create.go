// Copyright 2019-present Facebook Inc. All rights reserved.
// This source code is licensed under the Apache 2.0 license found
// in the LICENSE file in the root directory of this source tree.

// Code generated by ent, DO NOT EDIT.

package ent

import (
	"context"
	"errors"
	"fmt"
	"time"

	"entgo.io/ent/dialect/gremlin"
	"entgo.io/ent/dialect/gremlin/graph/dsl"
	"entgo.io/ent/dialect/gremlin/graph/dsl/g"
	"entgo.io/ent/entc/integration/ent/schema/task"
	enttask "entgo.io/ent/entc/integration/gremlin/ent/task"
)

// TaskCreate is the builder for creating a Task entity.
type TaskCreate struct {
	config
	mutation *TaskMutation
	hooks    []Hook
}

// SetPriority sets the "priority" field.
func (m *TaskCreate) SetPriority(v task.Priority) *TaskCreate {
	m.mutation.SetPriority(v)
	return m
}

// SetNillablePriority sets the "priority" field if the given value is not nil.
func (m *TaskCreate) SetNillablePriority(v *task.Priority) *TaskCreate {
	if v != nil {
		m.SetPriority(*v)
	}
	return m
}

// SetPriorities sets the "priorities" field.
func (m *TaskCreate) SetPriorities(v map[string]task.Priority) *TaskCreate {
	m.mutation.SetPriorities(v)
	return m
}

// SetCreatedAt sets the "created_at" field.
func (m *TaskCreate) SetCreatedAt(v time.Time) *TaskCreate {
	m.mutation.SetCreatedAt(v)
	return m
}

// SetNillableCreatedAt sets the "created_at" field if the given value is not nil.
func (m *TaskCreate) SetNillableCreatedAt(v *time.Time) *TaskCreate {
	if v != nil {
		m.SetCreatedAt(*v)
	}
	return m
}

// SetName sets the "name" field.
func (m *TaskCreate) SetName(v string) *TaskCreate {
	m.mutation.SetName(v)
	return m
}

// SetNillableName sets the "name" field if the given value is not nil.
func (m *TaskCreate) SetNillableName(v *string) *TaskCreate {
	if v != nil {
		m.SetName(*v)
	}
	return m
}

// SetOwner sets the "owner" field.
func (m *TaskCreate) SetOwner(v string) *TaskCreate {
	m.mutation.SetOwner(v)
	return m
}

// SetNillableOwner sets the "owner" field if the given value is not nil.
func (m *TaskCreate) SetNillableOwner(v *string) *TaskCreate {
	if v != nil {
		m.SetOwner(*v)
	}
	return m
}

// SetOrder sets the "order" field.
func (m *TaskCreate) SetOrder(v int) *TaskCreate {
	m.mutation.SetOrder(v)
	return m
}

// SetNillableOrder sets the "order" field if the given value is not nil.
func (m *TaskCreate) SetNillableOrder(v *int) *TaskCreate {
	if v != nil {
		m.SetOrder(*v)
	}
	return m
}

// SetOrderOption sets the "order_option" field.
func (m *TaskCreate) SetOrderOption(v int) *TaskCreate {
	m.mutation.SetOrderOption(v)
	return m
}

// SetNillableOrderOption sets the "order_option" field if the given value is not nil.
func (m *TaskCreate) SetNillableOrderOption(v *int) *TaskCreate {
	if v != nil {
		m.SetOrderOption(*v)
	}
	return m
}

// SetOp sets the "op" field.
func (m *TaskCreate) SetOp(v string) *TaskCreate {
	m.mutation.SetOpField(v)
	return m
}

// SetNillableOp sets the "op" field if the given value is not nil.
func (m *TaskCreate) SetNillableOp(v *string) *TaskCreate {
	if v != nil {
		m.SetOp(*v)
	}
	return m
}

// Mutation returns the TaskMutation object of the builder.
func (m *TaskCreate) Mutation() *TaskMutation {
	return m.mutation
}

// Save creates the Task in the database.
func (c *TaskCreate) Save(ctx context.Context) (*Task, error) {
	c.defaults()
	return withHooks(ctx, c.gremlinSave, c.mutation, c.hooks)
}

// SaveX calls Save and panics if Save returns an error.
func (c *TaskCreate) SaveX(ctx context.Context) *Task {
	v, err := c.Save(ctx)
	if err != nil {
		panic(err)
	}
	return v
}

// Exec executes the query.
func (c *TaskCreate) Exec(ctx context.Context) error {
	_, err := c.Save(ctx)
	return err
}

// ExecX is like Exec, but panics if an error occurs.
func (c *TaskCreate) ExecX(ctx context.Context) {
	if err := c.Exec(ctx); err != nil {
		panic(err)
	}
}

// defaults sets the default values of the builder before save.
func (c *TaskCreate) defaults() {
	if _, ok := c.mutation.Priority(); !ok {
		v := enttask.DefaultPriority
		c.mutation.SetPriority(v)
	}
	if _, ok := c.mutation.CreatedAt(); !ok {
		v := enttask.DefaultCreatedAt()
		c.mutation.SetCreatedAt(v)
	}
	if _, ok := c.mutation.GetOp(); !ok {
		v := enttask.DefaultOp
		c.mutation.SetOpField(v)
	}
}

// check runs all checks and user-defined validators on the builder.
func (c *TaskCreate) check() error {
	if _, ok := c.mutation.Priority(); !ok {
		return &ValidationError{Name: "priority", err: errors.New(`ent: missing required field "Task.priority"`)}
	}
	if v, ok := c.mutation.Priority(); ok {
		if err := v.Validate(); err != nil {
			return &ValidationError{Name: "priority", err: fmt.Errorf(`ent: validator failed for field "Task.priority": %w`, err)}
		}
	}
	if _, ok := c.mutation.CreatedAt(); !ok {
		return &ValidationError{Name: "created_at", err: errors.New(`ent: missing required field "Task.created_at"`)}
	}
	if _, ok := c.mutation.GetOp(); !ok {
		return &ValidationError{Name: "op", err: errors.New(`ent: missing required field "Task.op"`)}
	}
	if v, ok := c.mutation.GetOp(); ok {
		if err := enttask.OpValidator(v); err != nil {
			return &ValidationError{Name: "op", err: fmt.Errorf(`ent: validator failed for field "Task.op": %w`, err)}
		}
	}
	return nil
}

func (c *TaskCreate) gremlinSave(ctx context.Context) (*Task, error) {
	if err := c.check(); err != nil {
		return nil, err
	}
	res := &gremlin.Response{}
	query, bindings := c.gremlin().Query()
	if err := c.driver.Exec(ctx, query, bindings, res); err != nil {
		return nil, err
	}
	if err, ok := isConstantError(res); ok {
		return nil, err
	}
	rnode := &Task{config: c.config}
	if err := rnode.FromResponse(res); err != nil {
		return nil, err
	}
	c.mutation.id = &rnode.ID
	c.mutation.done = true
	return rnode, nil
}

func (c *TaskCreate) gremlin() *dsl.Traversal {
	v := g.AddV(enttask.Label)
	if value, ok := c.mutation.Priority(); ok {
		v.Property(dsl.Single, enttask.FieldPriority, value)
	}
	if value, ok := c.mutation.Priorities(); ok {
		v.Property(dsl.Single, enttask.FieldPriorities, value)
	}
	if value, ok := c.mutation.CreatedAt(); ok {
		v.Property(dsl.Single, enttask.FieldCreatedAt, value)
	}
	if value, ok := c.mutation.Name(); ok {
		v.Property(dsl.Single, enttask.FieldName, value)
	}
	if value, ok := c.mutation.Owner(); ok {
		v.Property(dsl.Single, enttask.FieldOwner, value)
	}
	if value, ok := c.mutation.Order(); ok {
		v.Property(dsl.Single, enttask.FieldOrder, value)
	}
	if value, ok := c.mutation.OrderOption(); ok {
		v.Property(dsl.Single, enttask.FieldOrderOption, value)
	}
	if value, ok := c.mutation.GetOp(); ok {
		v.Property(dsl.Single, enttask.FieldOp, value)
	}
	return v.ValueMap(true)
}

// TaskCreateBulk is the builder for creating many Task entities in bulk.
type TaskCreateBulk struct {
	config
	err      error
	builders []*TaskCreate
}
