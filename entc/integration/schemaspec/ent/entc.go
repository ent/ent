// Copyright 2019-present Facebook Inc. All rights reserved.
// This source code is licensed under the Apache 2.0 license found
// in the LICENSE file in the root directory of this source tree.

package ent

import (
	"fmt"

	"entgo.io/ent/entc"
	"entgo.io/ent/entc/gen"
	"entgo.io/ent/entc/integration/schemaspec/ent/schema"
)

func RunEntc(outputDir string) error {
	spec, err := schema.NewLoadSpec()
	if err != nil {
		return fmt.Errorf("creating load spec: %w", err)
	}
	err = entc.Generate(
		"",
		&gen.Config{
			Header: `
				// Copyright 2019-present Facebook Inc. All rights reserved.
				// This source code is licensed under the Apache 2.0 license found
				// in the LICENSE file in the root directory of this source tree.

				// Code generated by ent, DO NOT EDIT.
			`,
			Target: outputDir,
			SchemaSpec: spec,
		},
	)
	if err != nil {
		return fmt.Errorf("running ent codegen: %w", err)
	}
	return nil
}
