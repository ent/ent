{{/*
Copyright 2019-present Facebook Inc. All rights reserved.
This source code is licensed under the Apache 2.0 license found
in the LICENSE file in the root directory of this source tree.
*/}}

{{/* gotype: entgo.io/ent/entc/gen.typeScope */}}

{{ define "dialect/gremlin/delete" }}
{{ $builder := pascal $.Scope.Builder }}

func (d *{{ $builder }}) gremlinExec(ctx context.Context) (int, error) {
	res := &gremlin.Response{}
	query, bindings := d.gremlin().Query()
	if err := d.driver.Exec(ctx, query, bindings, res); err != nil {
		return 0, err
	}
	d.mutation.done = true
	return res.ReadInt()
}

func (d *{{ $builder }}) gremlin() *dsl.Traversal {
	t := g.V().HasLabel({{ $.Package }}.Label)
	for _, p := range d.mutation.predicates {
		p(t)
	}
	return t.SideEffect(__.Drop()).Count()
}
{{ end }}
