{{/*
Copyright 2019-present Facebook Inc. All rights reserved.
This source code is licensed under the Apache 2.0 license found
in the LICENSE file in the root directory of this source tree.
*/}}

{{/* custom errors and errors handlers for sql dialects */}}
{{ define "dialect/sql/errors" }}
func isSQLConstraintError(err error) (*ConstraintError, bool) {
    if sqlgraph.IsConstraintError(err) {
        return &ConstraintError{err.Error(), err}, true
    }
	return nil, false
}

// IsUniqueness reports whether the constraint that failed was a uniqueness constraint violation
// e.g. duplicate value in unique index
func (ce *ConstraintError) IsUniqueness() bool {
    return sqlgraph.IsUniqueConstraintError(ce.wrap)
}

// IsFK reports whether the constraint that failed was due to a foreign key constraint violation
// e.g. parent row does not exist.
func (ce *ConstraintError) IsFK() bool {
    return sqlgraph.IsForeignKeyConstraintError(ce.wrap)
}

// rollback calls tx.Rollback and wraps the given error with the rollback error if present.
func rollback(tx dialect.Tx, err error) error {
	if rerr := tx.Rollback(); rerr != nil {
		err = fmt.Errorf("%w: %v", err, rerr)
	}
	if err, ok := isSQLConstraintError(err); ok {
		return err
	}
	return err
}
{{ end }}
